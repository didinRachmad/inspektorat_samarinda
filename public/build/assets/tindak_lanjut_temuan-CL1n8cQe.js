import{r as l}from"./routes-De8qlvmc.js";const d={datatable:()=>l("tindak_lanjut_temuan.data")};class u{constructor(){this.pageName="Tindak Lanjut Temuan",this.datatableEl=$("#datatables")}initIndex(){console.log(`Halaman ${this.pageName} Index berhasil dimuat!`),this.initDataTable(),this.handleApprovalButtons()}initCreate(){console.log(`Halaman ${this.pageName} Create berhasil dimuat!`),this.initForm()}initEdit(){console.log(`Halaman ${this.pageName} Edit berhasil dimuat!`),this.initForm()}initShow(){console.log(`Halaman ${this.pageName} Show berhasil dimuat!`),this.handleApprovalButtons()}initDataTable(){this.datatableEl.DataTable({processing:!0,serverSide:!0,ajax:d.datatable(),columns:[{data:"DT_RowIndex",name:"DT_RowIndex",className:"text-center",orderable:!1,searchable:!1,title:"No"},{data:"id",name:"id",visible:!1,title:"ID"},{data:"nomor_lhp",name:"nomor_lhp",title:"Nomor LHP"},{data:"nama_auditi",name:"nama_auditi",title:"Auditi"},{data:"kode_nama_temuan",name:"kode_nama_temuan",title:"Nama Temuan"},{data:"judul_temuan",name:"judul_temuan",title:"Judul Temuan"},{data:"approval_status",name:"approval_status",className:"text-center",title:"Status",render:(e,o,t)=>{let a="secondary",n="-";switch(e){case"draft":a="secondary",n="Draft";break;case"waiting":a="warning",n="Menunggu Approval";break;case"approved":a="success",n="Disetujui";break}return`<span class="badge bg-${a}">${n}</span>`}},{data:"approval_note",name:"approval_note",title:"Note Approval"},{data:"batas_waktu",name:"batas_waktu",className:"text-center",title:"Batas Waktu",render:(e,o,t)=>e?`<span class="badge ${e.expired?"bg-danger":"bg-info"}">
                ${e.formatted}
            </span>`:"-"},{data:null,orderable:!1,searchable:!1,className:"text-center no-export",title:"Aksi",render:(e,o,t)=>{let a="";return t.can_show&&(a+=`
                <a href="${t.show_url}" class="btn btn-sm btn-info rounded-4" data-bs-toggle="tooltip" title="Detail">
                    <i class="bi bi-eye-fill"></i>
                </a>`),(t.can_approve||t.is_super_admin)&&(t.approval_status==="draft"?a+=`
                    <button type="button" class="btn btn-sm btn-success rounded-4 btn-approve"
                        data-url="${t.approve_url}" data-action="approve" data-bs-toggle="tooltip"
                        title="Kirim untuk Approval"><i class="bi bi-send"></i></button>`:a+=`
                    <button type="button" class="btn btn-sm btn-success rounded-4 btn-approve"
                        data-url="${t.approve_url}" data-action="approve" data-bs-toggle="tooltip" title="Setujui"><i class="bi bi-check-circle"></i></button>
                    <button type="button" class="btn btn-sm btn-secondary rounded-4 btn-revise"
                        data-url="${t.approve_url}" data-action="revise" data-bs-toggle="tooltip" title="Revisi"><i class="bi bi-arrow-return-left"></i></button>`),`<div class="d-flex justify-content-center gap-1">${a}</div>`}}],dom:"<'row'<'col-md-3'l><'col-md-6 text-center'><'col-md-3'f>><'row table-responsive py-2'<'col-sm-12'tr>><'row'<'col-md-5'i><'col-md-7'p>>",paging:!0,responsive:!0,pageLength:20,lengthMenu:[[20,50,-1],[20,50,"Semua"]],order:[[1,"desc"]],info:!0,language:{sEmptyTable:"Tidak ada data yang tersedia di tabel",sInfo:"Menampilkan _START_ hingga _END_ dari _TOTAL_ entri",sInfoFiltered:"(disaring dari _MAX_ entri keseluruhan)",sLengthMenu:"Tampilkan _MENU_ entri",sLoadingRecords:"Memuat...",sProcessing:"Sedang memproses...",sSearch:"Cari:",sZeroRecords:"Tidak ditemukan data yang cocok",oAria:{sSortAscending:": aktifkan untuk mengurutkan kolom menaik",sSortDescending:": aktifkan untuk mengurutkan kolom menurun"}},drawCallback:()=>$('[data-bs-toggle="tooltip"]').each(function(){new bootstrap.Tooltip(this)})})}handleApprovalButtons(){$(document).on("click",".btn-approve, .btn-reject, .btn-revise",e=>{const o=$(e.currentTarget),t=o.data("url"),a=o.data("action"),n=o.data("redirect"),i=a==="approve"?"Setujui":a==="reject"?"Tolak":"Revisi";showInputDialog(`${i} Tindak Lanjut Temuan`,"Tambahkan catatan (opsional):",r=>{fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},body:JSON.stringify({_method:"PATCH",action:a,note:r})}).then(s=>s.json()).then(s=>{s.status?(showToast(s.message,"success"),n?window.location.href=n:this.datatableEl.DataTable().ajax.reload(null,!1)):showAlert("Gagal",s.message||"Terjadi kesalahan","error")}).catch(s=>{console.error(s),showAlert("Error","Terjadi kesalahan pada server","error")})})})}initForm(){}}const m=new u;export{m as default};
